<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cat2cat - Introduction • cat2cat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="cat2cat - Introduction">
<meta property="og:description" content="cat2cat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cat2cat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">cat2cat - Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Polkas/cat2cat/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>cat2cat - Introduction</h1>
                        <h4 class="author">Maciej Nasinski</h4>
            
            <h4 class="date">2020-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Polkas/cat2cat/blob/master/vignettes/Introduction.Rmd"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(scipen = <span class="fl">999</span>)
<span class="kw">pacman</span>::<span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span>(<span class="kw">cat2cat</span>, <span class="kw">dplyr</span>)</pre></div>
<div id="in-development---transform-a-categorical-variable-according-to-a-new-encoding" class="section level1">
<h1 class="hasAnchor">
<a href="#in-development---transform-a-categorical-variable-according-to-a-new-encoding" class="anchor"></a>IN DEVELOPMENT - transform a categorical variable according to a new encoding</h1>
<p>IN DEVELOPMENT IN DEVELOPMENT IN DEVELOPMENT IN DEVELOPMENT IN DEVELOPMENT</p>
<p>In many projects where dataset contains a caterogical variable one of the biggest obstacle is that the data provider during internal proceesses was changing an encoding of this variable during a time.</p>
<p>Thus some categories were grouped and other were separated or a new one is added or an old one is removed.</p>
<p>There should be stated a 3 clear questions:</p>
<ol style="list-style-type: decimal">
<li>Do i have a transition table.</li>
<li>Type of the data - panel balanced or unbalanced or aggregate data vs individual data.</li>
<li>Direction of a transition, forward or backward - use a new or an old encoding</li>
</ol>
<div id="panel-unbalanced" class="section level2">
<h2 class="hasAnchor">
<a href="#panel-unbalanced" class="anchor"></a>panel unbalanced</h2>
<p>Here we could not observe what category have each observations across time: There is not a possibility to build automatically mapping We have to provide manually a mapping table - usually by a data provider like a country statistics office In worst case made it manually when supported by some officials directive.</p>
<p>ID, name, code, date<br>
uninformative anonymous carpenter 102 2020-02-10<br>
uninformative anonymous plumber 103 2020-02-10<br>
uninformative anonymous carpenter or plumber 121 2020-02-12<br>
uninformative anonymous carpenter or plumber 121 2020-02-12</p>
<p>Here we artificially enlarge degrees of freedom<br>
carpenter 121 2020-02-10<br>
plumber 121 2020-02-10<br>
carpenter 121 2020-02-12 50%<br>
plumber 121 2020-02-12 50%<br>
carpenter 121 2020-02-12 50%<br>
plumber 121 2020-02-12 50%</p>
</div>
<div id="panel-balanced" class="section level2">
<h2 class="hasAnchor">
<a href="#panel-balanced" class="anchor"></a>panel balanced</h2>
<p>Here we could observe what category have each observation across time: There is a possibility to build a mapping automatically</p>
<p>we could have new identifiers only in newest partition …<br>
or old identifiers which do not continue to participate in abandoned group</p>
<p>111 John Doe carpenter 102 2020-02-10<br>
222 Jimmy Smith plumber 103 2020-02-10<br>
111 John Doe carpenter or plumber 121 2020-02-12<br>
222 Jimmy Smith carpenter or plumber 121 2020-02-12</p>
<p>103,102 -&gt; 121</p>
<p>Here we want to adjust to a new encoding<br>
111 John Doe carpenter or plumber 121 2020-02-10<br>
222 Jimmy Smith carpenter or plumber 121 2020-02-10<br>
111 John Doe carpenter or plumber 121 2020-02-12<br>
222 Jimmy Smith carpenter or plumber 121 2020-02-12</p>
<p>Here we adjust to old encodingif we are sure that subjects have the same class. We have to assume that each person could not chenge the occupation which seems not reasonable. This assumption could be satste in other direction too for other example.</p>
<p>111 John Doe carpenter 102 2020-02-10<br>
222 Jimmy Smith plumber 103 2020-02-10<br>
111 John Doe carpenter 102 2020-02-12<br>
222 Jimmy Smith carpenter 103 2020-02-12</p>
<p>Thus the best solutioon could be build a transition table and use algoritm for ubalance data.</p>
<div id="simple-frequencies-vs-ml-module" class="section level3">
<h3 class="hasAnchor">
<a href="#simple-frequencies-vs-ml-module" class="anchor"></a>simple frequencies vs ML module</h3>
<p>The main objective is to merge X surveys published by Y over the years. We could get a few types of data:</p>
<p>ML unsupervised to choose most probable categories, narrow number of possible categories</p>
<div id="simple-freqencies" class="section level4">
<h4 class="hasAnchor">
<a href="#simple-freqencies" class="anchor"></a>Simple freqencies</h4>
<p>The first hash table - transitions:</p>
<pre><code>&gt; head(...)
$`1111`
[1] "1111"
$`1112`
[1] "1112"
$`1113`
[1] "1112"
$`1114`
[1] "1121" "1122" "1123"
$`1120`
[1] "1211" "1212"
$`1311`
[1] "1221" "1311"</code></pre>
<p>However each new observation has some probability of existence because of the fact that it could be assign to a few groups. Thus we built a next hash table which provide probabilities of attendance in each group. Probabilities were calculated using frequencies of people in each group at the previous survey. This should be obvious that for each observations which was replicated a few times probabilities have to sum to one. There were made some assumptions about cases such as when there was no the same group in the previous survey.</p>
<p>The second hash table - probabilities:</p>
<pre><code>&gt; head(cat_apply_freq(...) 
$`1111`                                        
[1] 1
$`1112`
[1] 1
$`1113`
[1] 1
$`1114`
[1] 0.3333333 0.3333333 0.3333333
$`1120`
[1] 0.8343979 0.1656021
$`1311`
[1] 0.95471934 0.04528066</code></pre>
<p>Finally we get the dataset which has additional rows from a replication process and 3 supplementary variables - new group,probability and number of replications.</p>
<p>Data should be preprocessed before building a regression model because of a high complexity. We implemented a deep explanatory analysis to understand data characteristics so right preprocessing decisions could be chosen.</p>
<p>The extended Mincer equation was used to estimate this relation. Logarithmic wages was regressed against individual characteristics relevant from the perspective of the labour market</p>
</div>
<div id="ml-module" class="section level4">
<h4 class="hasAnchor">
<a href="#ml-module" class="anchor"></a>ML module</h4>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>occup dataset is an example of unbalance panel dataset. It is presenting a characteristics from randomly selected company and then using k step procedure employees are chosen. The survey is anonymous and take place every two years. Use ?occup for more details.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">occup</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">trans</span>)</pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">occup</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>()</pre></div>
<pre><code>## Rows: 68,370
## Columns: 12
## $ id        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …
## $ age       &lt;dbl&gt; 49.29183, 33.95678, 30.98335, 55.26238, 34.05539, 35.23543,…
## $ sex       &lt;lgl&gt; FALSE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, TRUE, FALSE, …
## $ edu       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 4, 1, 1, 3, 2, 1, 1,…
## $ exp       &lt;dbl&gt; 26.461835, 7.536783, 7.483355, 24.762377, 10.055385, 11.235…
## $ district  &lt;int&gt; 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,…
## $ parttime  &lt;dbl&gt; 1.0000000, 1.0000000, 0.3333333, 1.0000000, 1.0000000, 1.00…
## $ salary    &lt;dbl&gt; 94730.94, 67619.39, 17862.90, 261882.46, 84540.17, 94002.69…
## $ code      &lt;chr&gt; "2471", "2471", "2471", "1112", "2471", "2479", "3431", "11…
## $ multipier &lt;dbl&gt; 223.2233, 279.4190, 240.4430, 233.9506, 254.0955, 261.7070,…
## $ year      &lt;int&gt; 2008, 2008, 2008, 2008, 2008, 2008, 2008, 2008, 2008, 2008,…
## $ code4     &lt;chr&gt; "2471", "2471", "2471", "1112", "2471", "2479", "3431", "11…</code></pre>
<p>trans dataset containing transitions between old (2008) and new (2010) occupational codes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">trans</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>()</pre></div>
<pre><code>## Rows: 2,666
## Columns: 2
## $ old &lt;chr&gt; "1111", "1111", "1111", "1112", "1112", "1112", "1121", "1122", "…
## $ new &lt;chr&gt; "111101", "111102", "111103", "111201", "111202", "111301", "1114…</code></pre>
<div style="page-break-after: always;"></div>
<div id="mappings" class="section level3">
<h3 class="hasAnchor">
<a href="#mappings" class="anchor"></a>Mappings</h3>
<p>If you are interested in the utils functions here are presented some</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">mappings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mappings.html">get_mappings</a></span>(<span class="kw">trans</span>)

<span class="kw">mappings</span><span class="op">$</span><span class="kw">to_old</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>]</pre></div>
<pre><code>## $`111101`
## [1] "1111"
## 
## $`111102`
## [1] "1111"
## 
## $`111103`
## [1] "1111"
## 
## $`111201`
## [1] "1112"</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">mappings</span><span class="op">$</span><span class="kw">to_new</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>]</pre></div>
<pre><code>## $`1111`
## [1] "111101" "111102" "111103"
## 
## $`1112`
## [1] "111201" "111202" "111301"
## 
## $`1121`
## [1] "111402"
## 
## $`1122`
## [1] "111401" "111403" "111404"</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">mapp_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat_apply_freq.html">cat_apply_freq</a></span>(<span class="kw">mappings</span><span class="op">$</span><span class="kw">to_old</span>, <span class="fu"><a href="../reference/get_freqs.html">get_freqs</a></span>(<span class="kw">occup</span><span class="op">$</span><span class="kw">code4</span>[<span class="kw">occup</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="st">"2008"</span>], <span class="kw">occup</span><span class="op">$</span><span class="kw">multipier</span>[<span class="kw">occup</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="st">"2008"</span>]))

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="kw">mappings</span><span class="op">$</span><span class="kw">to_old</span>), <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="kw">mapp_p</span>)) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></div>
<pre><code>##        mappings.to_old mapp_p
## 111101            1111      1
## 111102            1111      1
## 111103            1111      1
## 111201            1112      1
## 111202            1112      1
## 111301            1112      1</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">mapp_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat_apply_freq.html">cat_apply_freq</a></span>(<span class="kw">mappings</span><span class="op">$</span><span class="kw">to_new</span>, <span class="fu"><a href="../reference/get_freqs.html">get_freqs</a></span>(<span class="kw">occup</span><span class="op">$</span><span class="kw">code4</span>[<span class="kw">occup</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="st">"2010"</span>], <span class="kw">occup</span><span class="op">$</span><span class="kw">multipier</span>[<span class="kw">occup</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="st">"2010"</span>]))

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="kw">mappings</span><span class="op">$</span><span class="kw">to_new</span>), <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="kw">mapp_p</span>)) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></div>
<pre><code>##      mappings.to_new       mapp_p
## 1111    111101, .... 0.333333....
## 1112    111201, .... 0.333333....
## 1121          111402            1
## 1122    111401, .... 0.333333....
## 1123          111405            1
## 1211    112007, .... 0.25, 0.....</code></pre>
<div style="page-break-after: always;"></div>
</div>
<div id="cat2cat-applied-for-occup-data-panel" class="section level3">
<h3 class="hasAnchor">
<a href="#cat2cat-applied-for-occup-data-panel" class="anchor"></a>cat2cat applied for occup data panel</h3>
<p>splitting the data</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">occup_old</span> <span class="op">=</span> <span class="kw">occup</span>[<span class="kw">occup</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="fl">2008</span>,]
<span class="kw">occup_new</span> <span class="op">=</span> <span class="kw">occup</span>[<span class="kw">occup</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="fl">2010</span>,]</pre></div>
<p>simple model where probabilities will be taken from a category freqency.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="../reference/cat2cat.html">cat2cat</a></span>(
  data = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(old = <span class="kw">occup_old</span> ,new = <span class="kw">occup_new</span>, cat_var = <span class="st">"code"</span>, time_var = <span class="st">"year"</span>),
  mappings = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(trans = <span class="kw">trans</span>, direction = <span class="st">"forward"</span>)
  )</pre></div>
<pre><code>## $old
## # A tibble: 34,176 x 17
##       id   age sex     edu   exp district parttime salary code  multipier  year
##    &lt;int&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;int&gt; &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
##  1     1  49.3 FALSE     1 26.5         8    1     9.47e4 2471       223.  2008
##  2     2  34.0 FALSE     1  7.54        8    1     6.76e4 2471       279.  2008
##  3     3  31.0 TRUE      1  7.48        8    0.333 1.79e4 2471       240.  2008
##  4     4  55.3 TRUE      1 24.8         8    1     2.62e5 1112       234.  2008
##  5     5  34.1 TRUE      1 10.1         8    1     8.45e4 2471       254.  2008
##  6     6  35.2 FALSE     1 11.2         8    1     9.40e4 2479       262.  2008
##  7     7  32.4 FALSE     1  8.50        8    1     6.53e4 3431       256.  2008
##  8     8  48.0 TRUE      1 24.5         8    1     2.62e5 1112       251.  2008
##  9     9  51.0 FALSE     4 32.0         8    1     4.95e4 3431       259.  2008
## 10    10  69.6 FALSE     1 44.6         8    1     1.75e5 2422       245.  2008
## # … with 34,166 more rows, and 6 more variables: code4 &lt;chr&gt;, index_c2c &lt;int&gt;,
## #   g_new_c2c &lt;chr&gt;, wei_freq_c2c &lt;dbl&gt;, rep_c2c &lt;dbl&gt;, wei_naive_c2c &lt;dbl&gt;
## 
## $new
## # A tibble: 36,850 x 17
##       id   age sex     edu   exp district parttime salary code  multipier  year
##    &lt;int&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;int&gt; &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 34177  52.5 TRUE      1 29.5         8     1    9.39e4 1213…      240.  2010
##  2 34178  56.1 FALSE     6 35.7         8     0.67 2.81e4 9112…      265.  2010
##  3 34179  28.4 FALSE     1  6.36        8     1    4.35e4 4226…      232.  2010
##  4 34180  43.7 FALSE     5 23.0         8     1    3.37e4 9112…      225.  2010
##  5 34181  55.0 TRUE      6 34.6         6     1    7.27e4 8322…      230.  2010
##  6 34182  54.1 FALSE     4 27.9         8     1    4.73e4 3343…      215.  2010
##  7 34183  62.6 FALSE     8 24.6         8     1    2.15e4 9112…      221.  2010
##  8 34184  31.2 FALSE     1  6.37        8     1    7.53e4 2611…      202.  2010
##  9 34185  40.6 TRUE      1 18.9         8     1    1.02e5 2611…      255.  2010
## 10 34186  25.0 TRUE      5  5.82        8     1    2.11e4 9629…      226.  2010
## # … with 36,840 more rows, and 6 more variables: code4 &lt;chr&gt;, index_c2c &lt;int&gt;,
## #   g_new_c2c &lt;chr&gt;, wei_freq_c2c &lt;dbl&gt;, rep_c2c &lt;int&gt;, wei_naive_c2c &lt;dbl&gt;</code></pre>
</div>
<div id="ml-module-1" class="section level3">
<h3 class="hasAnchor">
<a href="#ml-module-1" class="anchor"></a>ml module</h3>
<p>Curentlly only knn method is availble.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">occup_2</span> <span class="op">=</span> <span class="fu"><a href="../reference/cat2cat.html">cat2cat</a></span>(
  data = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(old = <span class="kw">occup_old</span> ,new = <span class="kw">occup_new</span>, cat_var = <span class="st">"code"</span>, time_var = <span class="st">"year"</span>),
  mappings = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(trans = <span class="kw">trans</span>, direction = <span class="st">"forward"</span>)
  ,ml = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(method = <span class="st">"knn"</span>, features = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"edu"</span>, <span class="st">"exp"</span>, <span class="st">"parttime"</span>, <span class="st">"salary"</span>), args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(k = <span class="fl">10</span>))
  )</pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="kw">occup_2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>()</pre></div>
<pre><code>## List of 2
##  $ old: tibble [34,176 × 18] (S3: tbl_df/tbl/data.frame)
##   ..$ id           : int [1:34176] 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ age          : num [1:34176] 49.3 34 31 55.3 34.1 ...
##   ..$ sex          : logi [1:34176] FALSE FALSE TRUE TRUE TRUE FALSE ...
##   ..$ edu          : int [1:34176] 1 1 1 1 1 1 1 1 4 1 ...
##   ..$ exp          : num [1:34176] 26.46 7.54 7.48 24.76 10.06 ...
##   ..$ district     : int [1:34176] 8 8 8 8 8 8 8 8 8 8 ...
##   ..$ parttime     : num [1:34176] 1 1 0.333 1 1 ...
##   ..$ salary       : num [1:34176] 94731 67619 17863 261882 84540 ...
##   ..$ code         : chr [1:34176] "2471" "2471" "2471" "1112" ...
##   ..$ multipier    : num [1:34176] 223 279 240 234 254 ...
##   ..$ year         : int [1:34176] 2008 2008 2008 2008 2008 2008 2008 2008 2008 2008 ...
##   ..$ code4        : chr [1:34176] "2471" "2471" "2471" "1112" ...
##   ..$ index_c2c    : int [1:34176] 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ g_new_c2c    : chr [1:34176] "2471" "2471" "2471" "1112" ...
##   ..$ wei_freq_c2c : num [1:34176] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ rep_c2c      : num [1:34176] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ wei_naive_c2c: num [1:34176] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ wei_ml_c2c   : num [1:34176] 1 1 1 1 1 1 1 1 1 1 ...
##  $ new: tibble [36,850 × 18] (S3: tbl_df/tbl/data.frame)
##   ..$ id           : int [1:36850] 34177 34178 34179 34180 34181 34182 34183 34184 34185 34186 ...
##   ..$ age          : num [1:36850] 52.5 56.1 28.4 43.7 55 ...
##   ..$ sex          : logi [1:36850] TRUE FALSE FALSE FALSE TRUE FALSE ...
##   ..$ edu          : int [1:36850] 1 6 1 5 6 4 8 1 1 5 ...
##   ..$ exp          : num [1:36850] 29.49 35.73 6.36 23 34.6 ...
##   ..$ district     : int [1:36850] 8 8 8 8 6 8 8 8 8 8 ...
##   ..$ parttime     : num [1:36850] 1 0.67 1 1 1 1 1 1 1 1 ...
##   ..$ salary       : num [1:36850] 93946 28062 43532 33682 72680 ...
##   ..$ code         : chr [1:36850] "121303" "911207" "422602" "911290" ...
##   ..$ multipier    : num [1:36850] 240 265 232 225 230 ...
##   ..$ year         : int [1:36850] 2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
##   ..$ code4        : chr [1:36850] "1213" "9112" "4226" "9112" ...
##   ..$ index_c2c    : int [1:36850] 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ g_new_c2c    : Named chr [1:36850] "1239" "9132" "4222" "9132" ...
##   .. ..- attr(*, "names")= chr [1:36850] "121303" "911207" "422602" "911290" ...
##   ..$ wei_freq_c2c : Named num [1:36850] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..- attr(*, "names")= chr [1:36850] "121303" "911207" "422602" "911290" ...
##   ..$ rep_c2c      : Named int [1:36850] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..- attr(*, "names")= chr [1:36850] "121303" "911207" "422602" "911290" ...
##   ..$ wei_naive_c2c: Named num [1:36850] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..- attr(*, "names")= chr [1:36850] "121303" "911207" "422602" "911290" ...
##   ..$ wei_ml_c2c   : Named num [1:36850] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..- attr(*, "names")= chr [1:36850] "" "" "" "" ...</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">occup_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat2cat.html">cat2cat</a></span>(
  data = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(old = <span class="kw">occup_old</span>, new = <span class="kw">occup_new</span>, cat_var = <span class="st">"code"</span>, time_var = <span class="st">"year"</span>),
  mappings = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(trans = <span class="kw">trans</span>, direction = <span class="st">"backward"</span>),
  ml = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(method = <span class="st">"knn"</span>, features = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"edu"</span>, <span class="st">"exp"</span>, <span class="st">"parttime"</span>, <span class="st">"salary"</span>), args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(k = <span class="fl">10</span>))
)</pre></div>
<p>notice : if the ml model is failing then NA is returnd so</p>
<p>cor(occup_3<span class="math inline">\(old\)</span>wei_ml_c2c, occup_3<span class="math inline">\(old\)</span>wei_freq_c2c, use = “complete.obs”)</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="kw">occup_3</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>()</pre></div>
<pre><code>## List of 2
##  $ old: tibble [451,670 × 18] (S3: tbl_df/tbl/data.frame)
##   ..$ id           : int [1:451670] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ age          : num [1:451670] 49.3 49.3 49.3 49.3 49.3 ...
##   ..$ sex          : logi [1:451670] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   ..$ edu          : int [1:451670] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ exp          : num [1:451670] 26.5 26.5 26.5 26.5 26.5 ...
##   ..$ district     : int [1:451670] 8 8 8 8 8 8 8 8 8 8 ...
##   ..$ parttime     : num [1:451670] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ salary       : num [1:451670] 94731 94731 94731 94731 94731 ...
##   ..$ code         : chr [1:451670] "2471" "2471" "2471" "2471" ...
##   ..$ multipier    : num [1:451670] 223 223 223 223 223 ...
##   ..$ year         : int [1:451670] 2008 2008 2008 2008 2008 2008 2008 2008 2008 2008 ...
##   ..$ code4        : chr [1:451670] "2471" "2471" "2471" "2471" ...
##   ..$ index_c2c    : int [1:451670] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ g_new_c2c    : Named chr [1:451670] "335101" "242209" "242212" "242214" ...
##   .. ..- attr(*, "names")= chr [1:451670] "24711" "24712" "24713" "24714" ...
##   ..$ wei_freq_c2c : Named num [1:451670] 0.2124 0.0674 0.0155 0.0415 0.0466 ...
##   .. ..- attr(*, "names")= chr [1:451670] "24711" "24712" "24713" "24714" ...
##   ..$ rep_c2c      : Named int [1:451670] 11 11 11 11 11 11 11 11 11 11 ...
##   .. ..- attr(*, "names")= chr [1:451670] "2471" "2471" "2471" "2471" ...
##   ..$ wei_naive_c2c: Named num [1:451670] 0.0909 0.0909 0.0909 0.0909 0.0909 ...
##   .. ..- attr(*, "names")= chr [1:451670] "2471" "2471" "2471" "2471" ...
##   ..$ wei_ml_c2c   : Named num [1:451670] 0.2 0.4 0 0.2 0 0 0 0 0 0 ...
##   .. ..- attr(*, "names")= chr [1:451670] NA NA NA NA ...
##  $ new: tibble [34,194 × 18] (S3: tbl_df/tbl/data.frame)
##   ..$ id           : int [1:34194] 34177 34178 34179 34180 34181 34182 34183 34184 34185 34186 ...
##   ..$ age          : num [1:34194] 52.5 56.1 28.4 43.7 55 ...
##   ..$ sex          : logi [1:34194] TRUE FALSE FALSE FALSE TRUE FALSE ...
##   ..$ edu          : int [1:34194] 1 6 1 5 6 4 8 1 1 5 ...
##   ..$ exp          : num [1:34194] 29.49 35.73 6.36 23 34.6 ...
##   ..$ district     : int [1:34194] 8 8 8 8 6 8 8 8 8 8 ...
##   ..$ parttime     : num [1:34194] 1 0.67 1 1 1 1 1 1 1 1 ...
##   ..$ salary       : num [1:34194] 93946 28062 43532 33682 72680 ...
##   ..$ code         : chr [1:34194] "121303" "911207" "422602" "911290" ...
##   ..$ multipier    : num [1:34194] 240 265 232 225 230 ...
##   ..$ year         : int [1:34194] 2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
##   ..$ code4        : chr [1:34194] "1213" "9112" "4226" "9112" ...
##   ..$ index_c2c    : int [1:34194] 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ g_new_c2c    : chr [1:34194] "121303" "911207" "422602" "911290" ...
##   ..$ wei_freq_c2c : num [1:34194] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ rep_c2c      : num [1:34194] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ wei_naive_c2c: num [1:34194] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ wei_ml_c2c   : num [1:34194] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>New freqs for potential next step:</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="fu"><a href="../reference/get_freqs.html">get_freqs</a></span>(x = <span class="kw">occup_3</span><span class="op">$</span><span class="kw">new</span><span class="op">$</span><span class="kw">g_new_c2c</span>, multipier = <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="kw">occup_3</span><span class="op">$</span><span class="kw">new</span><span class="op">$</span><span class="kw">multipier</span> <span class="op">*</span> <span class="kw">occup_3</span><span class="op">$</span><span class="kw">new</span><span class="op">$</span><span class="kw">wei_freq_c2c</span>)) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></div>
<pre><code>##    input  Freq
## 1 111102   228
## 2 111103  3517
## 3 111201  1233
## 4 111301 12182
## 5 111405  1028
## 6 112001  4741</code></pre>
<p>or backward:</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="fu"><a href="../reference/get_freqs.html">get_freqs</a></span>(x = <span class="kw">occup_2</span><span class="op">$</span><span class="kw">old</span><span class="op">$</span><span class="kw">g_new_c2c</span>, multipier = <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="kw">occup_2</span><span class="op">$</span><span class="kw">old</span><span class="op">$</span><span class="kw">multipier</span> <span class="op">*</span> <span class="kw">occup_2</span><span class="op">$</span><span class="kw">old</span><span class="op">$</span><span class="kw">wei_freq_c2c</span>))<span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</pre></div>
<pre><code>##   input   Freq
## 1  1112  12977
## 2  1123   1268
## 3  1211 124293
## 4  1212  44410
## 5  1221   2256
## 6  1222  11668</code></pre>
<div style="page-break-after: always;"></div>
</div>
<div id="example---linear-regressions" class="section level3">
<h3 class="hasAnchor">
<a href="#example---linear-regressions" class="anchor"></a>Example - linear regressions:</h3>
<p>Remember to correct degrees of freedom</p>
</div>
<div id="providing-mappings-manually" class="section level3">
<h3 class="hasAnchor">
<a href="#providing-mappings-manually" class="anchor"></a>providing mappings manually</h3>
<p>example of aggragate dataset where we want to specify transitions manually:</p>
<p>Simulate the data.</p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)

<span class="kw">agg_old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  vertical = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Electronics"</span>, <span class="st">"Kids1"</span>, <span class="st">"Kids2"</span>, <span class="st">"Automotive"</span>, <span class="st">"Books"</span>, <span class="st">"Clothes"</span>, <span class="st">"Home"</span>, <span class="st">"Fashion"</span>, <span class="st">"Health"</span>, <span class="st">"Sport"</span>),
  sales = <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">10</span>),
  counts = <span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html">rgeom</a></span>(<span class="fl">10</span>, <span class="fl">0.0001</span>),
  v_date = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"2020-04-01"</span>, <span class="fl">10</span>), stringsAsFactors = <span class="kw">F</span>
)

<span class="kw">agg_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  vertical = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Electronics"</span>, <span class="st">"Supermarket"</span>, <span class="st">"Kids"</span>, <span class="st">"Automotive1"</span>, <span class="st">"Automotive2"</span>, <span class="st">"Books"</span>, <span class="st">"Clothes"</span>, <span class="st">"Home"</span>, <span class="st">"Fashion"</span>, <span class="st">"Health"</span>, <span class="st">"Sport"</span>),
  sales = <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">11</span>, <span class="fl">100</span>, <span class="fl">10</span>),
  counts = <span class="fu"><a href="https://rdrr.io/r/stats/Geometric.html">rgeom</a></span>(<span class="fl">11</span>, <span class="fl">0.0001</span>),
  v_date = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"2020-05-01"</span>, <span class="fl">11</span>), stringsAsFactors = <span class="kw">F</span>
)</pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="kw">agg_old</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>()</pre></div>
<pre><code>## Rows: 10
## Columns: 4
## $ vertical &lt;chr&gt; "Electronics", "Kids1", "Kids2", "Automotive", "Books", "Clo…
## $ sales    &lt;dbl&gt; 87.92934, 102.77429, 110.84441, 76.54302, 104.29125, 105.060…
## $ counts   &lt;int&gt; 9544, 17686, 32349, 135, 7489, 1078, 2414, 7399, 16102, 4957
## $ v_date   &lt;chr&gt; "2020-04-01", "2020-04-01", "2020-04-01", "2020-04-01", "202…</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="kw">agg_old</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>()</pre></div>
<pre><code>## Rows: 10
## Columns: 4
## $ vertical &lt;chr&gt; "Electronics", "Kids1", "Kids2", "Automotive", "Books", "Clo…
## $ sales    &lt;dbl&gt; 87.92934, 102.77429, 110.84441, 76.54302, 104.29125, 105.060…
## $ counts   &lt;int&gt; 9544, 17686, 32349, 135, 7489, 1078, 2414, 7399, 16102, 4957
## $ v_date   &lt;chr&gt; "2020-04-01", "2020-04-01", "2020-04-01", "2020-04-01", "202…</code></pre>
<p>Remember that after that you have to aggrage the results in a proper way. Moreover each analysis could requires specific aggregation process.</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="co"># old -&gt; new,new, old-&gt; old,new</span>
<span class="kw">agg1</span> <span class="op">=</span> <span class="fu"><a href="../reference/cat2cat_agg.html">cat2cat_agg</a></span>(data = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(old = <span class="kw">agg_old</span>, new = <span class="kw">agg_new</span>, cat_var = <span class="st">"vertical"</span>, time_var = <span class="st">"v_date"</span>,freq_var = <span class="st">"counts"</span>),
            <span class="kw">Automotive</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Automotive1</span>, <span class="kw">Automotive2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Kids1</span>, <span class="kw">Kids2</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Kids</span>), <span class="kw">Home</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Home</span>, <span class="kw">Supermarket</span>))

<span class="kw">agg1</span><span class="op">$</span><span class="kw">old</span></pre></div>
<pre><code>##       vertical     sales counts     v_date prop
## 1  Electronics  87.92934   9544 2020-04-01    1
## 2        Kids1 102.77429  17686 2020-04-01    1
## 3        Kids2 110.84441  32349 2020-04-01    1
## 4   Automotive  76.54302    135 2020-04-01    1
## 5        Books 104.29125   7489 2020-04-01    1
## 6      Clothes 105.06056   1078 2020-04-01    1
## 7         Home  94.25260   2414 2020-04-01    1
## 8      Fashion  94.53368   7399 2020-04-01    1
## 9       Health  94.35548  16102 2020-04-01    1
## 10       Sport  91.09962   4957 2020-04-01    1</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="kw">agg1</span><span class="op">$</span><span class="kw">new</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">vertical</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(sales = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">sales</span><span class="op">*</span><span class="kw">prop</span>), counts = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">counts</span><span class="op">*</span><span class="kw">prop</span>), v_date = <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span>(<span class="kw">v_date</span>))</pre></div>
<pre><code>## # A tibble: 10 x 4
##    vertical    sales counts v_date    
##    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
##  1 Automotive  202.  56492  2020-05-01
##  2 Books       112.  14239  2020-05-01
##  3 Clothes     108.  27185  2020-05-01
##  4 Electronics  82.7   859  2020-05-01
##  5 Fashion      85.2  4981  2020-05-01
##  6 Health      104.   1934  2020-05-01
##  7 Home        178.  29375  2020-05-01
##  8 Kids1        37.3   309. 2020-05-01
##  9 Kids2        68.2   565. 2020-05-01
## 10 Sport        99.3  9843  2020-05-01</code></pre>
<p>changes in both direction.</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="kw">agg2</span> <span class="op">=</span> <span class="fu"><a href="../reference/cat2cat_agg.html">cat2cat_agg</a></span>(data = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(old = <span class="kw">agg_old</span>, new = <span class="kw">agg_new</span>, cat_var = <span class="st">"vertical"</span>, time_var = <span class="st">"v_date"</span>, freq_var = <span class="st">"counts"</span>), 
            <span class="kw">Automotive</span> <span class="op">%&lt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Automotive1</span>, <span class="kw">Automotive2</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Kids1</span>, <span class="kw">Kids2</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Kids</span>), <span class="kw">Home</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Home</span>, <span class="kw">Supermarket</span>))</pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="kw">agg2</span><span class="op">$</span><span class="kw">old</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">vertical</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(sales = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">sales</span><span class="op">*</span><span class="kw">prop</span>), counts = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">counts</span><span class="op">*</span><span class="kw">prop</span>), v_date = <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span>(<span class="kw">v_date</span>))</pre></div>
<pre><code>## # A tibble: 11 x 4
##    vertical    sales  counts v_date    
##    &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     
##  1 Automotive1  49.4    87.1 2020-04-01
##  2 Automotive2  27.2    47.9 2020-04-01
##  3 Books       104.   7489   2020-04-01
##  4 Clothes     105.   1078   2020-04-01
##  5 Electronics  87.9  9544   2020-04-01
##  6 Fashion      94.5  7399   2020-04-01
##  7 Health       94.4 16102   2020-04-01
##  8 Home         94.3  2414   2020-04-01
##  9 Kids1       103.  17686   2020-04-01
## 10 Kids2       111.  32349   2020-04-01
## 11 Sport        91.1  4957   2020-04-01</code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="kw">agg2</span><span class="op">$</span><span class="kw">new</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">vertical</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(sales = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">sales</span><span class="op">*</span><span class="kw">prop</span>), counts = <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">counts</span><span class="op">*</span><span class="kw">prop</span>), v_date = <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span>(<span class="kw">v_date</span>))</pre></div>
<pre><code>## # A tibble: 11 x 4
##    vertical    sales counts v_date    
##    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
##  1 Automotive1 100.  36453  2020-05-01
##  2 Automotive2 102.  20039  2020-05-01
##  3 Books       112.  14239  2020-05-01
##  4 Clothes     108.  27185  2020-05-01
##  5 Electronics  82.7   859  2020-05-01
##  6 Fashion      85.2  4981  2020-05-01
##  7 Health      104.   1934  2020-05-01
##  8 Home        178.  29375  2020-05-01
##  9 Kids1        37.3   309. 2020-05-01
## 10 Kids2        68.2   565. 2020-05-01
## 11 Sport        99.3  9843  2020-05-01</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Maciej Nasinski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
