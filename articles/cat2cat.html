<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Started • cat2cat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get Started">
<meta property="og:description" content="cat2cat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cat2cat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cat2cat.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Polkas/cat2cat/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cat2cat_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get Started</h1>
                        <h4 data-toc-skip class="author">Maciej Nasinski</h4>
            
            <h4 data-toc-skip class="date">2022-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Polkas/cat2cat/blob/HEAD/vignettes/cat2cat.Rmd" class="external-link"><code>vignettes/cat2cat.Rmd</code></a></small>
      <div class="hidden name"><code>cat2cat.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="cat2cat">
<code>cat2cat</code><a class="anchor" aria-label="anchor" href="#cat2cat"></a>
</h2>
<p>The introduced <code>cat2cat</code> algorithm was designed to offer an easy and clear interface to apply a transition table which was provided by a data maintainer or built by a researcher. The objective is to unify an inconsistent coded categorical variable in a panel dataset, where a transition table is the core element of the process.</p>
<p>Examples of a dataset with such inconsistent coded categorical variable are ISCO (The International Standard Classification of Occupations) or ICD (International Classification of Diseases) based one. The both classifications are regularly updated to adjust to e.g. new science achievements. More clearly we might image that e.g. new science achievements brings new occupations types on the market or enable recognition of new diseases types.</p>
<p>The categorical variable encoding changes are typically provided by datasets providers in the form of transition table, for each time point the changes occurred. A transition table conveys information needed for matching all categories between two periods of time. More precisely it contains two columns where the first column contains old categories and the second column contains the new ones. Sometimes a transition table has to be created manually by a researcher.</p>
<p>The main rule is to replicate the observation if it could be assigned to a few categories. More precisely for each observation we look across a transition table to check how the original category could be mapped to the opposite period one. Then using simple frequencies or statistical methods to approximate probabilities of being assigned to each of them. For each observation that was replicated, the probabilities have to add up to one. The algorithm distinguishes different mechanics for panel data with and without unique identifiers.</p>
</div>
<div class="section level2">
<h2 id="core-elements">Core elements<a class="anchor" aria-label="anchor" href="#core-elements"></a>
</h2>
<p>There should be highlighted 3 important elements:</p>
<ol style="list-style-type: decimal">
<li>Type of the data - panel dataset with unique identifiers vs panel dataset without unique identifiers, aggregate data vs unit data.</li>
<li>Transition table.</li>
<li>Direction of a transition, forward or backward - a new or an old encoding as a base one.</li>
</ol>
</div>
<div class="section level2">
<h2 id="manual-transitions">Manual transitions<a class="anchor" aria-label="anchor" href="#manual-transitions"></a>
</h2>
<div class="section level3">
<h3 id="aggregate-dataset">Aggregate dataset<a class="anchor" aria-label="anchor" href="#aggregate-dataset"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Polkas/cat2cat" class="external-link">cat2cat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">verticals</span><span class="op">)</span>
<span class="va">agg_old</span> <span class="op">&lt;-</span> <span class="va">verticals</span><span class="op">[</span><span class="va">verticals</span><span class="op">$</span><span class="va">v_date</span> <span class="op">==</span> <span class="st">"2020-04-01"</span>, <span class="op">]</span>
<span class="va">agg_new</span> <span class="op">&lt;-</span> <span class="va">verticals</span><span class="op">[</span><span class="va">verticals</span><span class="op">$</span><span class="va">v_date</span> <span class="op">==</span> <span class="st">"2020-05-01"</span>, <span class="op">]</span>

<span class="co">## cat2cat_agg - could map in both directions at once although </span>
<span class="co">## usually we want to have old or new representation</span>

<span class="va">agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat2cat_agg.html">cat2cat_agg</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="va">agg_old</span>, 
                              new <span class="op">=</span> <span class="va">agg_new</span>, 
                              cat_var <span class="op">=</span> <span class="st">"vertical"</span>, 
                              time_var <span class="op">=</span> <span class="st">"v_date"</span>,
                              freq_var <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span>, 
                  <span class="va">Automotive</span> <span class="op">%&lt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Automotive1</span>, <span class="va">Automotive2</span><span class="op">)</span>,
                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Kids1</span>, <span class="va">Kids2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Kids</span><span class="op">)</span>,
                  <span class="va">Home</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Home</span>, <span class="va">Supermarket</span><span class="op">)</span><span class="op">)</span>
            
<span class="co">## possible processing</span>
  
<span class="va">agg</span><span class="op">$</span><span class="va">old</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vertical</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>sales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sales</span><span class="op">*</span><span class="va">prop_c2c</span><span class="op">)</span>, counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">*</span><span class="va">prop_c2c</span><span class="op">)</span>, v_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">v_date</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 11 × 4</span></span>
<span class="co">##    vertical    sales  counts v_date    </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> Automotive1  49.4    87.1 2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> Automotive2  27.2    47.9 2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> Books       104.   <span style="text-decoration: underline;">7</span>489   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> Clothes     105.   <span style="text-decoration: underline;">1</span>078   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> Electronics  87.9  <span style="text-decoration: underline;">9</span>544   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> Fashion      94.5  <span style="text-decoration: underline;">7</span>399   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> Health       94.4 <span style="text-decoration: underline;">16</span>102   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> Home         94.3  <span style="text-decoration: underline;">2</span>414   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> Kids1       103.  <span style="text-decoration: underline;">17</span>686   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> Kids2       111.  <span style="text-decoration: underline;">32</span>349   2020-04-01</span>
<span class="co">## <span style="color: #BCBCBC;">11</span> Sport        91.1  <span style="text-decoration: underline;">4</span>957   2020-04-01</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agg</span><span class="op">$</span><span class="va">new</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">vertical</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>sales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sales</span><span class="op">*</span><span class="va">prop_c2c</span><span class="op">)</span>, counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">*</span><span class="va">prop_c2c</span><span class="op">)</span>, v_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">v_date</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 11 × 4</span></span>
<span class="co">##    vertical    sales counts v_date    </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> Automotive1 100.  <span style="text-decoration: underline;">36</span>453  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> Automotive2 102.  <span style="text-decoration: underline;">20</span>039  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> Books       112.  <span style="text-decoration: underline;">14</span>239  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> Clothes     108.  <span style="text-decoration: underline;">27</span>185  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> Electronics  82.7   859  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> Fashion      85.2  <span style="text-decoration: underline;">4</span>981  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> Health      104.   <span style="text-decoration: underline;">1</span>934  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> Home        178.  <span style="text-decoration: underline;">29</span>375  2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> Kids1        37.3   309. 2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> Kids2        68.2   565. 2020-05-01</span>
<span class="co">## <span style="color: #BCBCBC;">11</span> Sport        99.3  <span style="text-decoration: underline;">9</span>843  2020-05-01</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="automatic-using-trans-table">Automatic using trans table<a class="anchor" aria-label="anchor" href="#automatic-using-trans-table"></a>
</h2>
<div class="section level3">
<h3 id="dataset-with-unique-identifiers">Dataset with unique identifiers<a class="anchor" aria-label="anchor" href="#dataset-with-unique-identifiers"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## the ean variable is a unique identifier</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">verticals2</span><span class="op">)</span>

<span class="va">vert_old</span> <span class="op">&lt;-</span> <span class="va">verticals2</span><span class="op">[</span><span class="va">verticals2</span><span class="op">$</span><span class="va">v_date</span> <span class="op">==</span> <span class="st">"2020-04-01"</span>, <span class="op">]</span>
<span class="va">vert_new</span> <span class="op">&lt;-</span> <span class="va">verticals2</span><span class="op">[</span><span class="va">verticals2</span><span class="op">$</span><span class="va">v_date</span> <span class="op">==</span> <span class="st">"2020-05-01"</span>, <span class="op">]</span>

<span class="co">## get transitions table</span>
<span class="va">trans_v</span> <span class="op">&lt;-</span> <span class="va">vert_old</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">vert_new</span>, by <span class="op">=</span> <span class="st">"ean"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">vertical.x</span>, <span class="va">vertical.y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># </span>
<span class="co">## cat2cat</span>
<span class="co">## it is important to set id_var as then we merging categories 1 to 1 </span>
<span class="co">## for this identifier which exists in both periods.</span>
<span class="va">verts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat2cat.html">cat2cat</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="va">vert_old</span>, new <span class="op">=</span> <span class="va">vert_new</span>, id_var <span class="op">=</span> <span class="st">"ean"</span>, cat_var <span class="op">=</span> <span class="st">"vertical"</span>, time_var <span class="op">=</span> <span class="st">"v_date"</span><span class="op">)</span>,
  mappings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="va">trans_v</span>, direction <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dataset-without-unique-identifiers">Dataset without unique identifiers<a class="anchor" aria-label="anchor" href="#dataset-without-unique-identifiers"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">occup</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trans</span><span class="op">)</span>

<span class="va">occup_old</span> <span class="op">&lt;-</span> <span class="va">occup</span><span class="op">[</span><span class="va">occup</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2008</span>,<span class="op">]</span>
<span class="va">occup_new</span> <span class="op">&lt;-</span> <span class="va">occup</span><span class="op">[</span><span class="va">occup</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span>,<span class="op">]</span>

<span class="co">## cat2cat</span>
<span class="va">occup_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat2cat.html">cat2cat</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="va">occup_old</span>, new <span class="op">=</span> <span class="va">occup_new</span>, cat_var <span class="op">=</span> <span class="st">"code"</span>, time_var <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>,
  mappings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="va">trans</span>, direction <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co">## with informative features it might be usefull to run ml algorithm</span>
<span class="co">## currently only knn, lda or rf (randomForest),  a few methods could be specified at once </span>
<span class="co">## where probability will be assessed as fraction of closest points.</span>
<span class="va">occup_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat2cat.html">cat2cat</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="va">occup_old</span>, new <span class="op">=</span> <span class="va">occup_new</span>, cat_var <span class="op">=</span> <span class="st">"code"</span>, time_var <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>,
  mappings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="va">trans</span>, direction <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span>,
  ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"knn"</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"edu"</span>, <span class="st">"exp"</span>, <span class="st">"parttime"</span>, <span class="st">"salary"</span><span class="op">)</span>, 
            args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># summary_plot</span>
<span class="fu"><a href="../reference/plot_c2c.html">plot_c2c</a></span><span class="op">(</span><span class="va">occup_2</span><span class="op">$</span><span class="va">old</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"both"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="cat2cat_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># mix of methods</span>
<span class="va">occup_2_mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cat2cat.html">cat2cat</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="va">occup_old</span>, new <span class="op">=</span> <span class="va">occup_new</span>, cat_var <span class="op">=</span> <span class="st">"code"</span>, time_var <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>,
  mappings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="va">trans</span>, direction <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span>,
  ml <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"knn"</span>, <span class="st">"rf"</span>, <span class="st">"lda"</span><span class="op">)</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"edu"</span>, <span class="st">"exp"</span>, <span class="st">"parttime"</span>, <span class="st">"salary"</span><span class="op">)</span>, 
            args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">10</span>, ntree <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="co"># correlation between ml models and simple fequencies</span>
<span class="va">occup_2_mix</span><span class="op">$</span><span class="va">old</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">wei_knn_c2c</span>, <span class="va">wei_rf_c2c</span>, <span class="va">wei_lda_c2c</span>, <span class="va">wei_freq_c2c</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##              wei_knn_c2c wei_rf_c2c wei_lda_c2c wei_freq_c2c</span>
<span class="co">## wei_knn_c2c    1.0000000  0.8587948   0.8406724    0.8974173</span>
<span class="co">## wei_rf_c2c     0.8587948  1.0000000   0.8874694    0.8738455</span>
<span class="co">## wei_lda_c2c    0.8406724  0.8874694   1.0000000    0.8894577</span>
<span class="co">## wei_freq_c2c   0.8974173  0.8738455   0.8894577    1.0000000</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># cross all methods and subset one highest probability category for each subject</span>
<span class="va">occup_old_mix_highest1</span> <span class="op">&lt;-</span> <span class="va">occup_2_mix</span><span class="op">$</span><span class="va">old</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
                <span class="fu"><a href="../reference/cross_c2c.html">cross_c2c</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
                <span class="fu"><a href="../reference/prune_c2c.html">prune_c2c</a></span><span class="op">(</span><span class="va">.</span>,column <span class="op">=</span> <span class="st">"wei_cross_c2c"</span>, method <span class="op">=</span> <span class="st">"highest1"</span><span class="op">)</span> </code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a>
</h2>
<p>The replication process is neutral for calculating at least the first 2 central moments for all variables. This is because for each observation which was replicated, probabilities sum to one. If we are removing non-zero probability observations then replication probabilities have to be reweighed to still sum to one. Important note is that removing non zero probability observations should be done only if needed, as it impact the counts of categorical variable levels. More preciously removing non-zero weights will influence the regression model if we will use the unified categorical variable.</p>
<div class="section level3">
<h3 id="regression-1">Regression<a class="anchor" aria-label="anchor" href="#regression-1"></a>
</h3>
<p>The next 3 regressions have the same results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## orginal dataset </span>
<span class="va">lms2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="va">parttime</span> <span class="op">+</span> <span class="va">exp</span>, <span class="va">occup_old</span>, weights <span class="op">=</span> <span class="va">multiplier</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lms2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## lm(formula = I(log(salary)) ~ age + sex + factor(edu) + parttime + </span>
<span class="co">##     exp, data = occup_old, weights = multiplier)</span>
<span class="co">## </span>
<span class="co">## Weighted Residuals:</span>
<span class="co">##     Min      1Q  Median      3Q     Max </span>
<span class="co">## -41.649  -4.154  -0.170   4.134  94.979 </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)   8.6049934  0.0175898 489.203  &lt; 2e-16 ***</span>
<span class="co">## age          -0.0028783  0.0004561  -6.311 2.81e-10 ***</span>
<span class="co">## sexTRUE       0.2539537  0.0050557  50.231  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)2 -0.0799110  0.0097006  -8.238  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)3 -0.3579335  0.0124684 -28.707  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)4 -0.4252729  0.0072134 -58.956  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)5 -0.4050551  0.0101847 -39.771  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)6 -0.6473797  0.0072134 -89.746  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)7 -0.5295860  0.0783593  -6.758 1.42e-11 ***</span>
<span class="co">## factor(edu)8 -0.6751645  0.0110551 -61.073  &lt; 2e-16 ***</span>
<span class="co">## parttime      1.9342513  0.0114274 169.264  &lt; 2e-16 ***</span>
<span class="co">## exp           0.0128464  0.0004370  29.396  &lt; 2e-16 ***</span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Residual standard error: 7.302 on 34164 degrees of freedom</span>
<span class="co">## Multiple R-squared:  0.5797, Adjusted R-squared:  0.5796 </span>
<span class="co">## F-statistic:  4284 on 11 and 34164 DF,  p-value: &lt; 2.2e-16</span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## using one highest cross weights</span>
<span class="co">## cross_c2c to cross differen methods weights</span>
<span class="co">## prune_c2c - highest1 leave only one the highest probability obs for each subject</span>
<span class="va">occup_old_2</span> <span class="op">&lt;-</span> <span class="va">occup_2</span><span class="op">$</span><span class="va">old</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
                <span class="fu"><a href="../reference/cross_c2c.html">cross_c2c</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wei_freq_c2c"</span>, <span class="st">"wei_knn_c2c"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
                <span class="fu"><a href="../reference/prune_c2c.html">prune_c2c</a></span><span class="op">(</span><span class="va">.</span>,column <span class="op">=</span> <span class="st">"wei_cross_c2c"</span>, method <span class="op">=</span> <span class="st">"highest1"</span><span class="op">)</span> 
<span class="va">lms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="va">parttime</span> <span class="op">+</span> <span class="va">exp</span>, <span class="va">occup_old_2</span>, weights <span class="op">=</span> <span class="va">multiplier</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lms</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## lm(formula = I(log(salary)) ~ age + sex + factor(edu) + parttime + </span>
<span class="co">##     exp, data = occup_old_2, weights = multiplier)</span>
<span class="co">## </span>
<span class="co">## Weighted Residuals:</span>
<span class="co">##     Min      1Q  Median      3Q     Max </span>
<span class="co">## -41.649  -4.154  -0.170   4.134  94.979 </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)   8.6049934  0.0175898 489.203  &lt; 2e-16 ***</span>
<span class="co">## age          -0.0028783  0.0004561  -6.311 2.81e-10 ***</span>
<span class="co">## sexTRUE       0.2539537  0.0050557  50.231  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)2 -0.0799110  0.0097006  -8.238  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)3 -0.3579335  0.0124684 -28.707  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)4 -0.4252729  0.0072134 -58.956  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)5 -0.4050551  0.0101847 -39.771  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)6 -0.6473797  0.0072134 -89.746  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)7 -0.5295860  0.0783593  -6.758 1.42e-11 ***</span>
<span class="co">## factor(edu)8 -0.6751645  0.0110551 -61.073  &lt; 2e-16 ***</span>
<span class="co">## parttime      1.9342513  0.0114274 169.264  &lt; 2e-16 ***</span>
<span class="co">## exp           0.0128464  0.0004370  29.396  &lt; 2e-16 ***</span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Residual standard error: 7.302 on 34164 degrees of freedom</span>
<span class="co">## Multiple R-squared:  0.5797, Adjusted R-squared:  0.5796 </span>
<span class="co">## F-statistic:  4284 on 11 and 34164 DF,  p-value: &lt; 2.2e-16</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## we have to adjust size of stds as we artificialy enlarge degrees of freedom</span>
<span class="va">occup_old_3</span> <span class="op">&lt;-</span> <span class="va">occup_2</span><span class="op">$</span><span class="va">old</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
                <span class="fu"><a href="../reference/prune_c2c.html">prune_c2c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"nonzero"</span><span class="op">)</span> <span class="co">#many prune methods like highest</span>
<span class="va">lms_replicated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="va">parttime</span> <span class="op">+</span> <span class="va">exp</span>, <span class="va">occup_old_3</span>, weights <span class="op">=</span> <span class="va">multiplier</span> <span class="op">*</span> <span class="va">wei_freq_c2c</span><span class="op">)</span>
<span class="co"># Adjusted R2 is meaningless here</span>
<span class="va">lms_replicated</span><span class="op">$</span><span class="va">df.residual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occup_old</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lms_replicated</span><span class="op">$</span><span class="va">assign</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lms_replicated</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## lm(formula = I(log(salary)) ~ age + sex + factor(edu) + parttime + </span>
<span class="co">##     exp, data = occup_old_3, weights = multiplier * wei_freq_c2c)</span>
<span class="co">## </span>
<span class="co">## Weighted Residuals:</span>
<span class="co">##     Min      1Q  Median      3Q     Max </span>
<span class="co">## -34.550  -0.686  -0.045   0.616  65.260 </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)   8.6049934  0.0175898 489.203  &lt; 2e-16 ***</span>
<span class="co">## age          -0.0028783  0.0004561  -6.311 2.81e-10 ***</span>
<span class="co">## sexTRUE       0.2539537  0.0050557  50.231  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)2 -0.0799110  0.0097006  -8.238  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)3 -0.3579335  0.0124684 -28.707  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)4 -0.4252729  0.0072134 -58.956  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)5 -0.4050551  0.0101847 -39.771  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)6 -0.6473797  0.0072134 -89.746  &lt; 2e-16 ***</span>
<span class="co">## factor(edu)7 -0.5295860  0.0783593  -6.758 1.42e-11 ***</span>
<span class="co">## factor(edu)8 -0.6751645  0.0110551 -61.073  &lt; 2e-16 ***</span>
<span class="co">## parttime      1.9342513  0.0114274 169.264  &lt; 2e-16 ***</span>
<span class="co">## exp           0.0128464  0.0004370  29.396  &lt; 2e-16 ***</span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Residual standard error: 7.302 on 34164 degrees of freedom</span>
<span class="co">## Multiple R-squared:  0.5797, Adjusted R-squared:  -3.254 </span>
<span class="co">## F-statistic:  4284 on 11 and 34164 DF,  p-value: &lt; 2.2e-16</span></code></pre>
</div>
<div class="section level3">
<h3 id="regression-with-unified-variable">Regression with unified variable<a class="anchor" aria-label="anchor" href="#regression-with-unified-variable"></a>
</h3>
<p>Example regression model with usage of the unified variable (<code>g_new_c2c</code>). A separate model for each occupational group.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">occup_old_4</span> <span class="op">&lt;-</span> <span class="va">occup_2</span><span class="op">$</span><span class="va">old</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
                <span class="fu"><a href="../reference/prune_c2c.html">prune_c2c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"nonzero"</span><span class="op">)</span> <span class="co">#many prune methods like highest</span>
<span class="va">formula_oo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">edu</span><span class="op">)</span> <span class="op">+</span> <span class="va">parttime</span> <span class="op">+</span> <span class="va">exp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>
<span class="va">oo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">occup_old_4</span>, <span class="va">occup_2</span><span class="op">$</span><span class="va">new</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">g_new_c2c</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html" class="external-link">do</a></span><span class="op">(</span>
    lm <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">formula_oo</span>, <span class="va">.</span>, weights <span class="op">=</span> <span class="va">multiplier</span> <span class="op">*</span> <span class="va">wei_freq_c2c</span><span class="op">)</span><span class="op">)</span>, 
      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">lm</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">oo</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span>
<span class="co">## <span style="color: #949494;"># Rowwise: </span></span>
<span class="co">##   g_new_c2c lm        </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 111201    <span style="color: #949494;">&lt;smmry.lm&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 111301    <span style="color: #949494;">&lt;smmry.lm&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 111405    <span style="color: #949494;">&lt;smmry.lm&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 112001    <span style="color: #949494;">&lt;smmry.lm&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 112002    <span style="color: #949494;">&lt;smmry.lm&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">6</span> 112003    <span style="color: #949494;">&lt;smmry.lm&gt;</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">oo</span><span class="op">$</span><span class="va">lm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## lm(formula = formula_oo, data = ., weights = multiplier * wei_freq_c2c)</span>
<span class="co">## </span>
<span class="co">## Weighted Residuals:</span>
<span class="co">##    Min     1Q Median     3Q    Max </span>
<span class="co">## -7.277 -1.488 -0.145  1.362  6.923 </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##                   Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">## (Intercept)       8.520469   0.682841  12.478  &lt; 2e-16 ***</span>
<span class="co">## age               0.021666   0.013878   1.561  0.12433    </span>
<span class="co">## sexTRUE           0.089484   0.119301   0.750  0.45647    </span>
<span class="co">## factor(edu)2     -0.248113   0.187691  -1.322  0.19177    </span>
<span class="co">## factor(edu)4     -0.505550   0.255098  -1.982  0.05260 .  </span>
<span class="co">## parttime          1.758043   0.617628   2.846  0.00624 ** </span>
<span class="co">## exp               0.001256   0.010965   0.115  0.90920    </span>
<span class="co">## factor(year)2010  0.617386   0.148847   4.148  0.00012 ***</span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Residual standard error: 2.54 on 54 degrees of freedom</span>
<span class="co">## Multiple R-squared:  0.4966, Adjusted R-squared:  0.4313 </span>
<span class="co">## F-statistic:  7.61 on 7 and 54 DF,  p-value: 2.27e-06</span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maciej Nasinski.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
